name: Release on Tag Push

on:
  push:
    tags:
      - 'v*.*.*'  # åŒ¹é… v1.0.0ã€v1.2.3 ç­‰è¯­ä¹‰åŒ–ç‰ˆæœ¬å·

permissions:
  contents: write

jobs:
  release:
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–æ‰€æœ‰å†å²è®°å½•ï¼Œç”¨äºç”Ÿæˆå®Œæ•´çš„ changelog

      - name: Get tag information
        id: tag_info
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "tag_name=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "ğŸ“¦ å‡†å¤‡å‘å¸ƒç‰ˆæœ¬: $TAG_NAME"

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.tag_info.outputs.tag_name }}
          name: Release ${{ steps.tag_info.outputs.tag_name }}
          generate_release_notes: true  # è‡ªåŠ¨ç”Ÿæˆ release notesï¼ˆåŸºäº PR å’Œ commitsï¼‰
          draft: false                  # ç›´æ¥å‘å¸ƒï¼Œä¸æ˜¯è‰ç¨¿
          prerelease: false             # æ­£å¼ç‰ˆæœ¬ï¼Œä¸æ˜¯é¢„å‘å¸ƒç‰ˆæœ¬
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Release Success Notification
        if: success()
        run: |
          echo "âœ… Release ${{ steps.tag_info.outputs.tag_name }} åˆ›å»ºæˆåŠŸï¼"
          echo "ğŸ”— è®¿é—®: https://github.com/${{ github.repository }}/releases/tag/${{ steps.tag_info.outputs.tag_name }}"

      - name: Release Failed Notification
        if: failure()
        run: |
          echo "âŒ Release åˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"